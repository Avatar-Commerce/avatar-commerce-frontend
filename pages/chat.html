<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat with AI Avatar</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }

        .chat-container {
            display: grid;
            grid-template-columns: 400px 1fr;
            height: 100vh;
            background: white;
            max-width: 1400px;
            margin: 0 auto;
            box-shadow: 0 0 50px rgba(0,0,0,0.2);
        }

        /* Avatar Section */
        .avatar-section {
            background: linear-gradient(135deg, #1e293b, #334155);
            color: white;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .avatar-header {
            padding: 25px;
            text-align: center;
            background: rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .influencer-info {
            margin-bottom: 20px;
        }

        .influencer-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .influencer-bio {
            font-size: 0.9rem;
            opacity: 0.8;
            line-height: 1.4;
        }

        .avatar-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .avatar-display {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }

        .avatar-video {
            width: 100%;
            max-width: 300px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .avatar-video.speaking {
            transform: scale(1.05);
            box-shadow: 0 20px 60px rgba(94, 96, 206, 0.4);
        }

        .avatar-placeholder {
            width: 200px;
            height: 200px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
        }

        .voice-controls {
            padding: 20px;
            background: rgba(0,0,0,0.2);
        }

        .voice-selector {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 12px;
            color: white;
            width: 100%;
            margin-bottom: 15px;
        }

        .voice-selector option {
            background: #1e293b;
            color: white;
        }

        .voice-preview-btn {
            width: 100%;
            background: linear-gradient(135deg, #5e60ce, #7c3aed);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .voice-preview-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(94, 96, 206, 0.4);
        }

        /* Chat Section */
        .chat-section {
            display: flex;
            flex-direction: column;
            background: #f8fafc;
        }

        .chat-header {
            background: white;
            padding: 20px 30px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1e293b;
        }

        .chat-settings {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .setting-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #64748b;
        }

        .toggle-switch {
            position: relative;
            width: 40px;
            height: 20px;
            background: #cbd5e1;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: #5e60ce;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
        }

        .toggle-switch.active::after {
            left: 22px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            scroll-behavior: smooth;
        }

        .message {
            display: flex;
            margin-bottom: 25px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            position: relative;
        }

        .message-bubble {
            padding: 15px 20px;
            border-radius: 20px;
            position: relative;
            word-wrap: break-word;
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, #5e60ce, #7c3aed);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.avatar .message-bubble {
            background: white;
            color: #1e293b;
            border: 1px solid #e2e8f0;
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 12px;
            background: linear-gradient(135deg, #5e60ce, #7c3aed);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            margin-right: 0;
            margin-left: 12px;
            background: linear-gradient(135deg, #64748b, #475569);
            order: 2;
        }

        .message-time {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-top: 5px;
            text-align: right;
        }

        .message.avatar .message-time {
            text-align: left;
        }

        .avatar-response-video {
            width: 100%;
            max-width: 300px;
            border-radius: 15px;
            margin-top: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 20px;
            background: white;
            border-radius: 20px;
            border-bottom-left-radius: 5px;
            margin-bottom: 25px;
            border: 1px solid #e2e8f0;
            animation: slideIn 0.3s ease;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #94a3b8;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        .chat-input-container {
            background: white;
            padding: 25px 30px;
            border-top: 1px solid #e2e8f0;
        }

        .input-group {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        .chat-input {
            width: 100%;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 15px 20px;
            font-size: 1rem;
            resize: none;
            outline: none;
            transition: all 0.3s ease;
            min-height: 60px;
            max-height: 120px;
        }

        .chat-input:focus {
            border-color: #5e60ce;
            box-shadow: 0 0 0 3px rgba(94, 96, 206, 0.1);
        }

        .input-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .voice-btn {
            background: #f1f5f9;
            color: #64748b;
        }

        .voice-btn:hover {
            background: #e2e8f0;
            color: #475569;
        }

        .voice-btn.recording {
            background: #fecaca;
            color: #dc2626;
            animation: pulse 1s infinite;
        }

        .send-btn {
            background: linear-gradient(135deg, #5e60ce, #7c3aed);
            color: white;
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(94, 96, 206, 0.3);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Product recommendations */
        .product-recommendations {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            margin-top: 15px;
        }

        .product-recommendations h4 {
            color: #1e293b;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .product-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .product-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-color: #5e60ce;
        }

        .product-image {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
            border-radius: 8px;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #64748b;
        }

        .product-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 5px;
        }

        .product-price {
            font-size: 0.8rem;
            color: #5e60ce;
            font-weight: 600;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .chat-container {
                grid-template-columns: 1fr;
                grid-template-rows: 300px 1fr;
            }

            .avatar-section {
                flex-direction: row;
                align-items: center;
                padding: 20px;
            }

            .avatar-header {
                flex: 1;
                padding: 0;
                background: none;
                text-align: left;
            }

            .avatar-display {
                flex: none;
                padding: 0 0 0 20px;
            }

            .avatar-video {
                max-width: 150px;
            }

            .voice-controls {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <!-- Avatar Section -->
        <div class="avatar-section">
            <div class="avatar-header">
                <div class="influencer-info">
                    <div class="influencer-name" id="influencerName">Alex Creator</div>
                    <div class="influencer-bio" id="influencerBio">
                        Fashion & Lifestyle Influencer. Helping you discover amazing products and style tips!
                    </div>
                </div>
                
                <div class="avatar-status">
                    <div class="status-dot"></div>
                    <span>AI Avatar Online</span>
                </div>
            </div>

            <div class="avatar-display">
                <div class="avatar-placeholder" id="avatarPlaceholder">
                    <i class="fas fa-robot"></i>
                </div>
                <video id="avatarVideo" class="avatar-video" style="display: none;" muted>
                    <source src="" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>

            <div class="voice-controls">
                <select class="voice-selector" id="voiceSelector">
                    <option value="default">Sarah (Default)</option>
                    <option value="male">David (Professional)</option>
                    <option value="custom">Custom Voice</option>
                </select>
                <button class="voice-preview-btn" onclick="previewVoice()">
                    <i class="fas fa-play"></i> Preview Voice
                </button>
            </div>
        </div>

        <!-- Chat Section -->
        <div class="chat-section">
            <div class="chat-header">
                <div class="chat-title">Chat with AI Avatar</div>
                
                <div class="chat-settings">
                    <div class="setting-toggle">
                        <span>Voice Responses</span>
                        <div class="toggle-switch active" onclick="toggleVoiceResponses(this)"></div>
                    </div>
                    <div class="setting-toggle">
                        <span>Auto-play Videos</span>
                        <div class="toggle-switch active" onclick="toggleAutoplay(this)"></div>
                    </div>
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <!-- Welcome message -->
                <div class="message avatar">
                    <div class="message-avatar">AI</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            Hi there! ðŸ‘‹ I'm Alex's AI avatar. I'm here to help you discover amazing products and answer any questions you might have. What are you looking for today?
                        </div>
                        <div class="message-time">Just now</div>
                    </div>
                </div>
            </div>

            <div class="chat-input-container">
                <div class="input-group">
                    <div class="input-wrapper">
                        <textarea 
                            id="chatInput" 
                            class="chat-input" 
                            placeholder="Type your message here..." 
                            rows="1"
                            onkeydown="handleKeyPress(event)"
                        ></textarea>
                    </div>
                    
                    <div class="input-actions">
                        <button class="action-btn voice-btn" id="voiceBtn" onclick="toggleVoiceInput()">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button class="action-btn send-btn" id="sendBtn" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let chatState = {
            messages: [],
            isTyping: false,
            voiceEnabled: true,
            autoplayEnabled: true,
            currentVoice: 'default',
            avatarReady: false
        };

        // Sample avatar videos for demo
        const avatarVideos = {
            welcome: 'https://sample-videos.com/zip/10/mp4/SampleVideo_360x240_1mb.mp4',
            response1: 'https://sample-videos.com/zip/10/mp4/SampleVideo_720x480_1mb.mp4',
            response2: 'https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4'
        };

        // Initialize chat
        document.addEventListener('DOMContentLoaded', function() {
            initializeChat();
            loadAvatarConfig();
        });

        function initializeChat() {
            // Auto-resize textarea
            const chatInput = document.getElementById('chatInput');
            chatInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });

            // Load influencer data from URL params
            const urlParams = new URLSearchParams(window.location.search);
            const username = urlParams.get('username') || 'Alex Creator';
            
            document.getElementById('influencerName').textContent = username;
            document.title = `Chat with ${username}'s AI Avatar`;
        }

        function loadAvatarConfig() {
            // Load saved avatar configuration
            const saved = localStorage.getItem('avatarConfig');
            if (saved) {
                const config = JSON.parse(saved);
                chatState.avatarReady = true;
                
                // Show avatar video
                showAvatarVideo(config.avatarUrl);
                
                // Set voice
                chatState.currentVoice = config.voice;
                document.getElementById('voiceSelector').value = config.voice;
            }
        }

        function showAvatarVideo(videoUrl) {
            const placeholder = document.getElementById('avatarPlaceholder');
            const video = document.getElementById('avatarVideo');
            
            placeholder.style.display = 'none';
            video.style.display = 'block';
            video.src = videoUrl;
            
            if (chatState.autoplayEnabled) {
                video.play().catch(e => console.log('Autoplay prevented'));
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message || chatState.isTyping) return;
            
            // Add user message
            addMessage(message, 'user');
            input.value = '';
            input.style.height = 'auto';
            
            // Generate avatar response
            generateAvatarResponse(message);
        }

        function addMessage(text, sender, videoUrl = null, products = null) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatarInitial = sender === 'user' ? 'U' : 'AI';
            const timestamp = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            let messageHTML = `
                <div class="message-avatar">${avatarInitial}</div>
                <div class="message-content">
                    <div class="message-bubble">
                        ${escapeHtml(text)}
                        ${videoUrl ? `<video class="avatar-response-video" controls ${chatState.autoplayEnabled ? 'autoplay' : ''} muted><source src="${videoUrl}" type="video/mp4"></video>` : ''}
                        ${products ? generateProductRecommendations(products) : ''}
                    </div>
                    <div class="message-time">${timestamp}</div>
                </div>
            `;
            
            messageDiv.innerHTML = messageHTML;
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
            
            // Play avatar video if it's an avatar response with video
            if (sender === 'avatar' && videoUrl && chatState.avatarReady) {
                playAvatarVideo(videoUrl);
            }
        }

        function generateAvatarResponse(userMessage) {
            showTypingIndicator();
            chatState.isTyping = true;
            
            // Simulate API call delay
            setTimeout(() => {
                hideTypingIndicator();
                chatState.isTyping = false;
                
                // Generate contextual response
                const response = generateContextualResponse(userMessage);
                
                // Add avatar response with video
                const videoUrl = getRandomAvatarVideo();
                addMessage(response.text, 'avatar', videoUrl, response.products);
                
            }, 1500 + Math.random() * 1000); // Random delay 1.5-2.5s
        }

        function generateContextualResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Product recommendation responses
            if (lowerMessage.includes('recommend') || lowerMessage.includes('product') || lowerMessage.includes('buy')) {
                return {
                    text: "I'd love to help you find the perfect products! Based on what you're looking for, here are some amazing options I personally recommend:",
                    products: generateSampleProducts()
                };
            }
            
            // Fashion-related responses
            if (lowerMessage.includes('fashion') || lowerMessage.includes('style') || lowerMessage.includes('outfit')) {
                return {
                    text: "Fashion is my passion! I'm always excited to talk about the latest trends and help you create stunning looks. What's your style preference?",
                    products: null
                };
            }
            
            // General responses
            const responses = [
                "That's a great question! I'm here to help you with anything you need.",
                "I love chatting with you! Tell me more about what you're interested in.",
                "Thanks for sharing that with me! I'm always here to provide personalized recommendations.",
                "That's so interesting! I'd love to help you explore that further."
            ];
            
            return {
                text: responses[Math.floor(Math.random() * responses.length)],
                products: null
            };
        }

        function generateSampleProducts() {
            const products = [
                { name: "Stylish Handbag", price: "$89", icon: "fas fa-shopping-bag" },
                { name: "Designer Sunglasses", price: "$129", icon: "fas fa-glasses" },
                { name: "Cozy Sweater", price: "$65", icon: "fas fa-tshirt" },
                { name: "Trendy Sneakers", price: "$149", icon: "fas fa-shoe-prints" }
            ];
            
            return products.slice(0, 3); // Return 3 random products
        }

        function generateProductRecommendations(products) {
            return `
                <div class="product-recommendations">
                    <h4><i class="fas fa-star"></i> Recommended Products</h4>
                    <div class="product-grid">
                        ${products.map(product => `
                            <div class="product-item" onclick="openProductLink('${product.name}')">
                                <div class="product-image">
                                    <i class="${product.icon}"></i>
                                </div>
                                <div class="product-name">${product.name}</div>
                                <div class="product-price">${product.price}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function getRandomAvatarVideo() {
            const videos = Object.values(avatarVideos);
            return videos[Math.floor(Math.random() * videos.length)];
        }

        function playAvatarVideo(videoUrl) {
            const avatarVideo = document.getElementById('avatarVideo');
            avatarVideo.src = videoUrl;
            avatarVideo.classList.add('speaking');
            
            if (chatState.autoplayEnabled) {
                avatarVideo.play().catch(e => console.log('Autoplay prevented'));
            }
            
            // Remove speaking effect after video ends
            avatarVideo.addEventListener('ended', function() {
                avatarVideo.classList.remove('speaking');
            }, { once: true });
        }

        function showTypingIndicator() {
            const messagesContainer = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.className = 'typing-indicator';
            
            typingDiv.innerHTML = `
                <div class="message-avatar">AI</div>
                <div style="flex: 1;">
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(typingDiv);
            scrollToBottom();
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function scrollToBottom() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function toggleVoiceResponses(toggle) {
            toggle.classList.toggle('active');
            chatState.voiceEnabled = toggle.classList.contains('active');
        }

        function toggleAutoplay(toggle) {
            toggle.classList.toggle('active');
            chatState.autoplayEnabled = toggle.classList.contains('active');
        }

        function toggleVoiceInput() {
            const voiceBtn = document.getElementById('voiceBtn');
            const isRecording = voiceBtn.classList.contains('recording');
            
            if (isRecording) {
                stopVoiceRecording();
            } else {
                startVoiceRecording();
            }
        }

        function startVoiceRecording() {
            const voiceBtn = document.getElementById('voiceBtn');
            voiceBtn.classList.add('recording');
            voiceBtn.innerHTML = '<i class="fas fa-stop"></i>';
            
            // Simulate voice recording
            console.log('Voice recording started');
        }

        function stopVoiceRecording() {
            const voiceBtn = document.getElementById('voiceBtn');
            voiceBtn.classList.remove('recording');
            voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
            
            // Simulate voice to text
            const input = document.getElementById('chatInput');
            input.value = "Hello, I spoke this message using voice input!";
            
            console.log('Voice recording stopped');
        }

        function previewVoice() {
            const selectedVoice = document.getElementById('voiceSelector').value;
            const previewText = "Hi! This is how I sound with the selected voice option.";
            
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(previewText);
                utterance.rate = 0.9;
                utterance.pitch = selectedVoice === 'male' ? 0.8 : 1.1;
                speechSynthesis.speak(utterance);
            }
            
            chatState.currentVoice = selectedVoice;
        }

        function openProductLink(productName) {
            alert(`Opening product link for: ${productName}\n\nThis would redirect to the affiliate link for this product.`);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize with sample conversation
        setTimeout(() => {
            if (chatState.avatarReady) {
                showAvatarVideo(avatarVideos.welcome);
            }
        }, 1000);
    </script>
</body>
</html>